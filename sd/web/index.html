<!DOCTYPE html><head><meta charset = "utf-8">
<title>community corona 8</title>

<style type = "text/css">
* { 
  box-sizing: border-box;
}
div.sketch {
  position: relative; 
}
.io-slider-box {
  background-color: white; border: 1px solid gray; font-size: 12px;
  text-align: center; vertical-align: middle; line-height: 14px;
}
.io-slider-slide {
  padding: 0; margin: 0; -webkit-appearance: none; background: transparent;
}
.io-slider-slide::-ms-track {
  background: transparent; border-color: transparent; color: transparent;
}
.io-slider-slide::-webkit-slider-thumb {
  -webkit-appearance: none; width: 15px; height: 15px;
  border-radius: 20%; background: blue; cursor: pointer;
}
.io-slider-slide::-moz-range-thumb {
  height: 15px; width: 15px;
  border-radius: 20%; background: blue; cursor: pointer;
}
.io-slider-slide::-ms-thumb {
  height: 15px; width: 15px;
  border-radius: 20%; background: blue; cursor: pointer;
}
div.io-chart {
  background: white;
  border: 1px solid gray;
}
div.io-chart > .svg {
  width: 100%;
  height: 100%;
}
div.topBar * {
  display: inline-block;
}
h1, h3 {
  margin: 0 9px;
}
button.resetAll {
  padding: 12px 24px;
  text-align: center;
  font-size: 16px;
  margin: 12px;
}
</style>

<script type="text/javascript" src="mdl.js"></script>
<script type="text/javascript" src="vensim_wasm.js"></script>
<script type="text/javascript" src="wasm-arrays.min.js"></script>
<script type="text/javascript" src="d3.min.js"></script>
</head><body>
<h1>community corona 8</h1>

<div class="topBar">
<h3>powered by <a target="blank" href="https://vensim.com/">Vensim</a></h3>
<button class="resetAll">Reset All Sliders</button>
</div>

<div class="sketch">
<img src="sketch.png"></img>
<a class="sketchLink" href="http://metasd.com" style="position: absolute; top: 0px; left: 708px; width: 76px; height: 26px"></a>
<a class="sketchLink" href="http://vensim.com" style="position: absolute; top: 0px; left: 810px; width: 76px; height: 26px"></a>
<a class="sketchLink" href="https://opensource.org/licenses/MIT" style="position: absolute; top: 51px; left: 388px; width: 268px; height: 14px"></a>
<div class="io-slider-box" name="Incubation Time" style="position: absolute; top: 332px; left: 364px; width: 82px; height: 14px">
5
</div>
<input class="io-slider-slide" style="position: absolute; top: 346px; left: 364px; width: 82px" type="range" name="Incubation Time" min="1" max="10" value="5" step="0.1"></input>
<div class="io-slider-box" name="R0" style="position: absolute; top: 38px; left: 142px; width: 60px; height: 14px">
2.4
</div>
<input class="io-slider-slide" style="position: absolute; top: 52px; left: 142px; width: 60px" type="range" name="R0" min="1" max="4" value="2.4" step="0.01"></input>
<div class="io-slider-box" name="Infection Duration" style="position: absolute; top: 228px; left: 722px; width: 90px; height: 14px">
7
</div>
<input class="io-slider-slide" style="position: absolute; top: 242px; left: 722px; width: 90px" type="range" name="Infection Duration" min="1" max="10" value="7" step="0.1"></input>
<div class="io-slider-box" name="Initial Population" style="position: absolute; top: 334px; left: 120px; width: 84px; height: 14px">
6.65752e+07
</div>
<input class="io-slider-slide" style="position: absolute; top: 348px; left: 120px; width: 84px" type="range" name="Initial Population" min="1" max="200000" value="6.65752e+07" step="1000"></input>
<div class="io-slider-box" name="Infection Duration" style="position: absolute; top: 40px; left: 60px; width: 102px; height: 14px">
7
</div>
<input class="io-slider-slide" style="position: absolute; top: 54px; left: 60px; width: 102px" type="range" name="Infection Duration" min="1" max="10" value="7" step="0.1"></input>
<div class="io-slider-box" name="N Imported Infections" style="position: absolute; top: 114px; left: 381px; width: 106px; height: 14px">
5
</div>
<input class="io-slider-slide" style="position: absolute; top: 128px; left: 381px; width: 106px" type="range" name="N Imported Infections" min="0" max="100" value="5" step="1"></input>
<div class="io-slider-box" name="Import Time" style="position: absolute; top: 156px; left: 371px; width: 64px; height: 14px">
20
</div>
<input class="io-slider-slide" style="position: absolute; top: 170px; left: 371px; width: 64px" type="range" name="Import Time" min="1" max="100" value="20" step="1"></input>
<div class="io-slider-box" name="Isolation Reaction Time" style="position: absolute; top: 437px; left: 520px; width: 116px; height: 14px">
5
</div>
<input class="io-slider-slide" style="position: absolute; top: 451px; left: 520px; width: 116px" type="range" name="Isolation Reaction Time" min="1" max="30" value="5" step="0.1"></input>
<div class="io-slider-box" name="Behavior Reaction Time" style="position: absolute; top: 35px; left: 282px; width: 118px; height: 14px">
50
</div>
<input class="io-slider-slide" style="position: absolute; top: 49px; left: 282px; width: 118px" type="range" name="Behavior Reaction Time" min="1" max="60" value="50" step="1"></input>
<div class="io-slider-box" name="Behavioral Risk Reduction" style="position: absolute; top: 34px; left: 187px; width: 128px; height: 14px">
0
</div>
<input class="io-slider-slide" style="position: absolute; top: 48px; left: 187px; width: 128px" type="range" name="Behavioral Risk Reduction" min="0" max="1" value="0" step="0.01"></input>
<div class="io-slider-box" name="Hospital Capacity" style="position: absolute; top: 53px; left: 628px; width: 60px; height: 14px">
200000
</div>
<input class="io-slider-slide" style="position: absolute; top: 67px; left: 628px; width: 60px" type="range" name="Hospital Capacity" min="0" max="1000" value="200000" step="10"></input>
<div class="io-slider-box" name="Treated Fatality Rate" style="position: absolute; top: 65px; left: 706px; width: 104px; height: 14px">
0.2
</div>
<input class="io-slider-slide" style="position: absolute; top: 79px; left: 706px; width: 104px" type="range" name="Treated Fatality Rate" min="0" max="0.1" value="0.2" step="0.001"></input>
<div class="io-slider-box" name="Untreated Fatality Rate" style="position: absolute; top: 89px; left: 774px; width: 114px; height: 14px">
0.4
</div>
<input class="io-slider-slide" style="position: absolute; top: 103px; left: 774px; width: 114px" type="range" name="Untreated Fatality Rate" min="0" max="0.1" value="0.4" step="0.001"></input>
<div class="io-slider-box" name="Fraction Requiring Hospitalization" style="position: absolute; top: 114px; left: 493px; width: 94px; height: 14px">
0.1
</div>
<input class="io-slider-slide" style="position: absolute; top: 128px; left: 493px; width: 94px" type="range" name="Fraction Requiring Hospitalization" min="0" max="1" value="0.1" step="0.01"></input>
<div class="io-slider-box" name="Public Health Capacity" style="position: absolute; top: 354px; left: 673px; width: 80px; height: 14px">
1e+06
</div>
<input class="io-slider-slide" style="position: absolute; top: 368px; left: 673px; width: 80px" type="range" name="Public Health Capacity" min="-1e+06" max="2e+06" value="1e+06" step="10000"></input>
<div class="io-slider-box" name="Potential Isolation Effectiveness" style="position: absolute; top: 422px; left: 638px; width: 90px; height: 14px">
0
</div>
<input class="io-slider-slide" style="position: absolute; top: 436px; left: 638px; width: 90px" type="range" name="Potential Isolation Effectiveness" min="0" max="1" value="0" step="0.01"></input>
<div class="io-slider-box" name="Import Time" style="position: absolute; top: 442px; left: 413px; width: 76px; height: 14px">
20
</div>
<input class="io-slider-slide" style="position: absolute; top: 456px; left: 413px; width: 76px" type="range" name="Import Time" min="1" max="100" value="20" step="1"></input>
<div class="io-slider-box" name="Import Time" style="position: absolute; top: 73px; left: 336px; width: 76px; height: 14px">
20
</div>
<input class="io-slider-slide" style="position: absolute; top: 87px; left: 336px; width: 76px" type="range" name="Import Time" min="1" max="100" value="20" step="1"></input>
<div class="io-slider-box" name="Contact Density Decline" style="position: absolute; top: 88px; left: 0px; width: 118px; height: 14px">
0
</div>
<input class="io-slider-slide" style="position: absolute; top: 102px; left: 0px; width: 118px" type="range" name="Contact Density Decline" min="0" max="4" value="0" step="0.1"></input>
<div class="io-slider-box" name="Seasonal Amplitude" style="position: absolute; top: 435px; left: 234px; width: 100px; height: 14px">
0
</div>
<input class="io-slider-slide" style="position: absolute; top: 449px; left: 234px; width: 100px" type="range" name="Seasonal Amplitude" min="0" max="1" value="0" step="0.01"></input>
<div class="io-chart" name="Susceptible" varname="Susceptible" xaxisname="day" yaxisname="people" style="position: absolute; top: 458px; left: 12px; width: 226px; height: 226px"></div>
<div class="io-chart" name="Exposed" varname="Exposed" xaxisname="day" yaxisname="people" style="position: absolute; top: 458px; left: 236px; width: 226px; height: 226px"></div>
<div class="io-chart" name="Infected" varname="Infected" xaxisname="day" yaxisname="people" style="position: absolute; top: 458px; left: 460px; width: 226px; height: 226px"></div>
<div class="io-chart" name="Recovered" varname="Recovered" xaxisname="day" yaxisname="people" style="position: absolute; top: 458px; left: 684px; width: 226px; height: 226px"></div>
<div class="io-chart" name="Deaths" varname="Deaths" xaxisname="day" yaxisname="people" style="position: absolute; top: 458px; left: 909px; width: 226px; height: 226px"></div>
<div class="io-chart" name="Public Health Strain" varname="Public Health Strain" xaxisname="day" yaxisname="Index" style="position: absolute; top: 233px; left: 908px; width: 226px; height: 226px"></div>
<div class="io-chart" name="Hospital Strain" varname="Hospital Strain" xaxisname="day" yaxisname="Index" style="position: absolute; top: 8px; left: 908px; width: 226px; height: 226px"></div>
<div class="io-chart" name="Confirmed" varname="Confirmed" xaxisname="day" yaxisname="people" style="position: absolute; top: 457px; left: 1131px; width: 226px; height: 226px"></div>
</div>

<script type="text/javascript">

var VensimLoadedFlag = 0;

function OnVensimLoaded()
	{
		VensimLoadedFlag = _IsVensimLoaded();
		runModel(0);
	}


var VensimCharts = [];

function UpdateCharts(run)
	{
            var margin = {left: 70, right: 30, top: 30, bottom: 50};
			d3.selectAll("div.io-chart").each(function() {
				var div = d3.select(this);
				var width = parseInt(div.style("width"), 10);
				var height = parseInt(div.style("height"), 10);
				var temp = ["0", "0", width, height];
				div.selectAll("svg").data([0]).join("svg").attr("viewBox", temp.join(","));
				var chart = div.select("svg");
				var fTimeVals = GetSeries("Time");
                                var varname = div.attr("varname");
				var fVals = GetSeries(varname);
                                if (!VensimCharts[varname]) {
                                    VensimCharts[varname] = { runs: [] };
                                }
                                var o = VensimCharts[varname];
                                o.runs[run] = {
                                    times: fTimeVals,
                                    vals: fVals,
                                }

                                var vmin = Number.MAX_VALUE;
                                var vmax = -Number.MAX_VALUE;
                                for (r in o.runs) {
                                    vmin = Math.min(vmin, d3.min(o.runs[r].vals));
                                    vmax = Math.max(vmax, d3.max(o.runs[r].vals));
                                }
                chart.selectAll("text.title")
                  .data([0])
                  .join("text").attr("class", "title")
                  .attr("x", (width - margin.left - margin.right)/2 + margin.left)
                  .attr("y", (margin.top / 2))
                  .attr("text-anchor", "middle")
                  .style("font-size", "16px")
                  .text(div.attr("name"));
                var xscale = d3.scaleLinear()
                    .domain([d3.min(fTimeVals), d3.max(fTimeVals)])
                    .range([margin.left, width - margin.right]);
                chart.selectAll("g.xaxis")
                  .data([0])
                  .join("g").attr("class", "xaxis")
                  .attr("transform", "translate(0, " + (height - margin.bottom) + ")")
                  .call(d3.axisBottom(xscale).ticks(width / 80).tickSizeOuter(0));
                chart.selectAll("text.xunits")
                  .data([0])
                  .join("text").attr("class", "xunits")
                  .attr("x", (width - margin.left - margin.right)/2 + margin.left)
                  .attr("y", height - 14)
                  .attr("text-anchor", "middle")
                  .style("font-size", "16px")
                  .text(div.attr("xaxisname"));
                var yscale = d3.scaleLinear()
                    .domain([vmin, vmax])
                    .range([margin.top, height - margin.bottom]);
                var yscale_inv = d3.scaleLinear()
                    .domain([vmin, vmax])
                    .range([height - margin.bottom, margin.top]);
                chart.selectAll("g.yaxis")
                  .data([0])
                  .join("g").attr("class", "yaxis")
                  .attr("transform", "translate(" + margin.left + ", 0)")
                  .call(d3.axisLeft(yscale_inv));
                chart.selectAll("text.yunits")
                  .data([0])
                  .join("text").attr("class", "yunits")
                  .attr("transform", "rotate(-90)")
                  .attr("y", 16)
                  .attr("x", -(height - margin.top - margin.bottom)/2 - margin.top)
                  .attr("text-anchor", "middle")
                  .style("font-size", "16px")
                  .text(div.attr("yaxisname"));
                for (r in o.runs) {
                    var color = "red";
                    if (r == 0) { color = "blue"; }
                    chart.selectAll("path.data" + r)
                      .data([o.runs[r].vals])
                      .join("path").attr("class", "data" + r).attr("d", (d, i) => 
                        d3.line()
                          .x((d, i) => xscale(o.runs[r].times[i]))
                          .y((d) => height - margin.bottom - yscale(d) + margin.top)(d))
                      .attr("stroke", color)
                      .attr("fill", "none");
                }
            });
}
function resetAllSliders() {
d3.selectAll("input.io-slider-slide").nodes().forEach(function(i){
i.value = i.getAttribute("value");
d3.selectAll("div.io-slider-box[name=\"" + i.name + "\"]").text(i.valueAsNumber);
});
}

function runModel(run) {
if (  VensimLoadedFlag == 0)
{
	return;
}

InitializeModel();
// set all slider constants
d3.selectAll("input.io-slider-slide").each(function() {
	//console.log("Setting " + this.name + " to " + this.valueAsNumber);
	SetConstant(this.name, this.valueAsNumber);
});
RunSim();
UpdateCharts(run);
}

resetAllSliders();

d3.select("button.resetAll").nodes()[0].onclick = function() {
resetAllSliders();
runModel(1);
}

d3.selectAll("input.io-slider-slide").nodes().forEach(function(i){
i.oninput = function() {
// update the number shown for all sliders of this var
d3.selectAll("div.io-slider-box[name=\"" + i.name + "\"]").text(i.valueAsNumber);
d3.selectAll("input.io-slider-slide[name=\"" + i.name + "\"]").each(function() { this.value = i.valueAsNumber; })
runModel(1);
};
});

</script>

</body></html>
